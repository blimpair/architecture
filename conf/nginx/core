#
#      GENERIC ENVIRONMENT
#
server {
    listen 80;
    server_name 127.0.0.1;
    root /var/www/7.0;

    # include snippets/common;
    ## Logs
	# disable access log and define error_log to critical.
	access_log off;

	## Headers
	add_header X-System Progress44;
	add_header Access-Control-Allow-Origin *;

	## Index
	index index.html index.htm index.php;

	## 
	# Disable logging for robots.txt
	location = /robots.txt {
	    allow all;
	    log_not_found off;
	    access_log off;
	}
    
    #include snippets/deny;
    # Deny access to special dirs or files or source files
	location ~* \.(engine|inc|info|install|make|module|profile|test|po|sh|.*sql|theme|tpl(\.php)?|xtmpl)$|^(\..*|Entries.*|Repository|Root|Tag|Template)$|\.php_ {
            deny all;
    }

  	# Deny all attempts to access hidden files such as .htaccess, .htpasswd, .DS_Store (Mac).
	location ~ /\. {
	    deny all;
	    access_log off;
	    log_not_found off;
	}

    #include snippets/rewrite;
    # Checking if a file exists, if it doesn't the rewrite rule is applied
    location / {
            try_files $uri $uri/ @rewrites;
    }

    # Rewrite rules
    location @rewrites {
            rewrite .* /index.php last;
    }

    #include snippets/hhphp5.6;
	location ~ \.(hh|php)$ {
	    fastcgi_intercept_errors on;
	    error_page 502 = @fallback;
	    fastcgi_keep_conn on;
	    include         snippets/fastcgi-php.conf;
	    fastcgi_pass    php:9009;
	}

	location @fallback {
	    # NOTE: You should have "cgi.fix_pathinfo = 0;" in php.ini
	    include snippets/fastcgi-php.conf;
	    fastcgi_pass unix:/run/php/php7.0-fpm.sock;
	}

    #include snippets/caching;
    # Enabling Caching for static content
    location ~* .(gif|jpg|jpeg|png|ico|wmv|3gp|avi|mpg|mpeg|mp4|flv|mp3|mid|js|css|wml|swf)$ {
        expires max;
        add_header Pragma public;
        add_header Cache-Control "public, must-revalidate, proxy-revalidate";
        log_not_found off;
    }

}