#!/bin/sh
set -e
service php7.0-fpm start

# first arg is `-f` or `--some-option`
if [ "${1#-}" != "$1" ]; then
	set -- php "$@"
fi

if [ -z "$(ls -A $WORKDIR | grep $PROJECT_NAME)" ]; then
	cd $WORKDIR

	composer create-project aeria/work $PROJECT_NAME

	if [ -z "$(ls -A $WORKDIR/$PROJECT_NAME | grep server)" ]
	then
		ln -sf $WORKDIR/nginx/$PROJECT_NAME $WORKDIR/$PROJECT_NAME/server/
	fi

	if [ -z "$(ls -A $WORKDIR/$PROJECT_NAME | grep nginx)" ]
	then
		ln -sf $WORKDIR/nginx/$PROJECT_NAME $WORKDIR/$PROJECT_NAME/nginx/
	fi
fi

exec "$@"